<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Font awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

     <!-- Meta Description: Focus on the purpose of the page -->
     <meta name="description" content="Roovix Shop - Your trusted e-commerce platform in Bangladesh for top-quality products. Discover a wide range of electronics, fashion, home goods, and more. A marketplace for everyone, where buying and selling is simple and reliable.">

     <!-- Meta Keywords: Relevant to the login and user account -->
     <meta name="keywords" content="Roovix Shop, e-commerce Bangladesh, online shopping BD, product selling BD, electronics, fashion, home goods, online marketplace, trusted shop Bangladesh, buy and sell online, best e-commerce BD">
 
     <!-- Author: Your brand or company name -->
     <meta name="author" content="Roovix">
 
     <!-- Open Graph Meta Tags for better sharing on social media -->
     <meta name="msapplication-TileImage" content="https://roovix.com/images/logo.png">
     <meta property="og:site_name" content="Roovix Shop">
     <meta property="og:title" content="Check out this amazing product!" />
     <meta property="og:description" content="Hereâ€™s a product you might find interesting." />
     <meta property="og:image" itemprop="image" content="https://roovix.com/images/logo.png" />
     <meta property="og:url" content="https://roovix.com/ptoduct" />
     <meta property="og:type" content="website" />
     <meta property="og:image:type" content="image/png">
     <meta property="og:image:width" content="300">
     <meta property="og:image:height" content="300">     
     <meta name="google-site-verification" content="kcvJtB49mIavOu-GxZRCTRqS9p8UbMVva1Tq0JLZs8A" />
     <meta name="robots" content="index, follow">

    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://roovix.com/images/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://roovix.com/images/logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://roovix.com/images/logo.png">


    <script src="config.js"></script>
    <link rel="stylesheet" href="styles/product_card.css">
    <link rel="stylesheet" href="styles/product_category.css">
    <link rel="stylesheet" href="styles/index.css" />
    <link rel="stylesheet" href="styles/banners.css">

    <!-- Aos animation css link= -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <!-- Bootstrap css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <title>Roovix Shop</title>
  
  </head>
  <body class="body">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="https://roovix.com">Roovix Shop</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item" id="my_dashboard">
            <a class="nav-link" style="cursor: pointer;">Dashboard</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Courses
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="courses/roovix_courses">Marketing</a>
              <a class="dropdown-item" href="courses/roovix_courses">Python Course</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="courses/roovix_courses">Website dev Course</a>
            </div>
          </li>
          <li class="nav-item" id="open-user-login" onclick="openLoginPage()">
            <a class="nav-link" style="cursor: pointer;">Login</a>
          </li>
          <li class="nav-item">
            <button id="refer_earn">Refer & Earn</button>
          </li>
        </ul>
        <form id="search_form" class="form-inline my-2 my-lg-0">
          <input id="search" class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
      </div>
    </nav>

    <!-- button for scroll to top -->
    <i id="scroll-up-btn" class="fa-solid fa-angles-up"></i>
    
    <section id="dynamic_banners">
      <div id="dynamic_banners_list" class="dynamic_banners_list">
        <!-- Banners will be shown here dynamically -->
      </div>
    </section>

    <section id="product-list">
      <div class="action_top">
        <ul id="categoryList">
          <li id="all" class="selected" onclick="selectCategory(this)">All</li>
          <li id="fashions" onclick="selectCategory(this)">Fashions</li>
          <li id="watches" onclick="selectCategory(this)">Watches</li>
          <li id="electronics" onclick="selectCategory(this)">Electronics</li>
          <li id="kitchen appliances" onclick="selectCategory(this)">Kitchen</li>
          <li id="sports" onclick="selectCategory(this)">Sports</li>
          <li id="toys" onclick="selectCategory(this)">Toys</li>
          <li id="skin care products" onclick="selectCategory(this)">Skin_Care</li>
          <li id="hair care products" onclick="selectCategory(this)">Hair_Care</li>
          <li id="home appliances" onclick="selectCategory(this)">Home_Appliances</li>
          <li id="fishing" onclick="selectCategory(this)">Fishing</li>
          <li id="books" onclick="selectCategory(this)">Books</li>
          <li id="health supplements" onclick="selectCategory(this)">Health</li>
          <li id="furnitures" onclick="selectCategory(this)">Furnitures</li>
          <li id="travel accessories" onclick="selectCategory(this)">Travel_Accessories</li>
        </ul>
      </div>
      <i id="spinner" class="fa-solid fa-spinner"></i>
      <div id="products_list_container" class="list-container">
        <!-- Product cards will be dynamically generated here -->
      </div>
    </section>

    <script>
      // Set the website name by name id
      document.getElementById("name").innerText = name;
            // Function to handle category selection
            function selectCategory(selectedItem) {
            // Remove 'selected' class from all list items
            const items = document.querySelectorAll('#categoryList li');
            items.forEach(item => {
                item.classList.remove('selected');
            });

            // Add 'selected' class and custom styles to the clicked item
            selectedItem.classList.add('selected');
            
        }

        // Default selection: Select the first item when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            const defaultItem = document.querySelector('#categoryList li.selected');
            if(defaultItem){
              selectCategory(defaultItem);
            }
        });
    </script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
      import {
        getDatabase,
        ref,
        onValue,
        get,
        set,
        update
      } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js";
      import {
        getAuth,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-auth.js";

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const auth = getAuth(app);
      let isUser = false;
      let category = "all";
      let user_id = "";

      function checkForUser(){
        auth.onAuthStateChanged((user)=>{
        if(user){
          isUser = true;
          user_id = user.uid;
          document.getElementById("open-user-login").style.display = "none";
        }else{
          isUser = false;
        }
      });
      }
      checkForUser();


      // Show banners in the page
      function fetchBanners() {
        const dynamic_banners_list = document.getElementById("dynamic_banners_list");
        const bannersRef = ref(db, "admin/banners");
        onValue(bannersRef, (snapshot)=>{
          const banners = snapshot.val();
          if(banners){
            
            // Empty thr banner list container
            dynamic_banners_list.innerHTML = "";
            let bannersHtml = "";

            // Banner in banners
            for(const bannerId in banners){
              const banner = banners[bannerId];

              bannersHtml += `
                <div id="banner_card_${bannerId}" class="banner_card">
                    <div class="banner_image_container">
                        <img src="${banner.image}" alt="${banner.title}">
                        <div class="banner_title_overlay">${banner.title}</div>
                    </div>
                </div>
              `

            }

            // Update innerHTML once
            dynamic_banners_list.innerHTML = bannersHtml;

            // Add click event listeners for each banner card
            for (const bannerId in banners) {
              document.getElementById(`banner_card_${bannerId}`).addEventListener("click", () => {
                window.location.href = banners[bannerId].link;
              });
            }


          }else{
            console.log("No banners added");
            document.getElementById("dynamic_banners").style.display = "none";
          }
        });
      }
      fetchBanners();



      let productsToShow = 6;  // Number of products to show initially and on each "Load More"
      let allProducts = [];  // Store all fetched products
      let displayedProducts = 0;  // Track how many products have been displayed
      
      // Handle category click
      const categoryList = document.getElementById("categoryList");
      categoryList.addEventListener("click", (event) => {
        if (event.target.id) {
          if (event.target.id === "categoryList") {
            category = "all";
            return;
          }
          category = event.target.id;
          resetProductDisplay();
          fetchProduct();
        }
      });
      
      // Reset for a fresh load of products
      function resetProductDisplay() {
        displayedProducts = 0;
        allProducts = [];
        document.getElementById("products_list_container").innerHTML = "";  // Clear previous products
        document.getElementById("loadMoreBtn")?.remove();  // Remove the "Load More" button if it exists
      }
      
      // Fetch product
      function fetchProduct() {
        const products_list_container = document.getElementById("products_list_container");
        document.getElementById("spinner").style.display = "block"; // Show the spinner while fetching
      
        const productsRef = ref(db, `products`);
        onValue(productsRef, (snapshot) => {
      
          if (snapshot) {
            const products = snapshot.val();
            const productArray = [];
      
            // Collect products into an array
            for (const productId in products) {
              const product = products[productId];
              productArray.push({ id: productId, ...product });
            }
      
            // Filter products by category first
            const filteredProducts = category === "all" 
              ? productArray 
              : productArray.filter(product => product.category.toLowerCase() === category);
      
            // Shuffle the filtered product array
            const shuffledProducts = shuffleArray(filteredProducts);
      
            // Store all products
            allProducts = shuffledProducts;
      
            // Initially display the first few products
            displayProducts();
      
          } else {
            document.getElementById("products_list_container").innerHTML = `<p>No products found</p>`;
            document.getElementById("spinner").style.display = "none";
          }
      
        });
      }
      
      // Display products based on how many should be shown
      function displayProducts() {
        const products_list_container = document.getElementById("products_list_container");
      
        // Get the slice of products to display
        const productsToDisplay = allProducts.slice(displayedProducts, displayedProducts + productsToShow);
      
        let product_html = '';  // Accumulate HTML for products
        productsToDisplay.forEach((productData) => {
          const productId = productData.id;
          const product = productData;
          const product_link = product.link;
      
          let price_div = '';
          if (product.price && product.currency && product.discount) {
            const formattedPrice = parseInt(product.price).toLocaleString();
            const formattedDiscount = parseInt(product.discount).toLocaleString();
      
            price_div = `
              <p class="price">
                <span class="currency">${product.currency}</span>
                <span class="price_inside">${formattedPrice}</span>
                <span class="discount">${formattedDiscount}</span>
              </p>`;
          }
      
          product_html += `
            <div class="product-card">
              <div class="image_container">
                <img id="image_click_${productId}" class="image" src="${product.image}">
              </div>
              <div class="details_container">
                <div class="product_description_container">
                  <p class="description">${product.description}</p>
                </div>
                <div class="price_container">
                  ${price_div}
                </div>
                <div class="action_container">
                  <button class="action_btn" id="action_btn_${productId}">${product.action_btn_value}</button>
                  <button class="share_btn" id="share_btn_${productId}"><i class="fa-solid fa-share-from-square"></i></button>
                </div>
                <div class="verify_container">
                  <p class="product_verify"><i class="fa-solid fa-certificate"></i> Product Verified by Roovix</p>
                </div>
              </div>
            </div>
          `;
        });
      
        // Insert the products into the container
        products_list_container.innerHTML += product_html;  // Append the new products instead of replacing old ones
        displayedProducts += productsToDisplay.length;
      
        // Hide spinner after the products are loaded
        document.getElementById("spinner").style.display = "none";
      
        // Add event listeners for the products (for ALL products, not just the newly loaded ones)
        allProducts.forEach((productData) => {
          const productId = productData.id;
          const product = productData;
      
          const button = document.getElementById(`action_btn_${productId}`);
          if (button) {
            button.addEventListener('click', function() {
              window.open(product.link, '_blank');
            });
          }
      
          const image = document.getElementById(`image_click_${productId}`);
          if (image) {
            image.addEventListener('click', function() {
              window.open(product.link, '_blank');
            });
          }
      
          const shareButton = document.getElementById(`share_btn_${productId}`);
          if (shareButton) {
            shareButton.addEventListener('click', function() {
              let userId = user_id || null;
              const dp_id_full = product.link;
              const dp_id = dp_id_full.split("/").pop(); 
              const product_url = `https://roovix.com/product?product_id=${productId}&user_id=${userId}&dp_id=${dp_id}`;
              shareLink(product_url);
            });
          }
        });
      
        // Add "Load More" button if there are more products to load
        if (displayedProducts < allProducts.length) {
          let loadMoreBtn = document.getElementById("loadMoreBtn");
      
          if (!loadMoreBtn) {
            // Only create the button if it doesn't already exist
            loadMoreBtn = document.createElement("button");
            loadMoreBtn.id = "loadMoreBtn";
            loadMoreBtn.className = "load-more-btn";
            loadMoreBtn.innerText = "Load More";
      
            // Attach event listener to the "Load More" button
            loadMoreBtn.addEventListener("click", () => {
              displayProducts();  // Show the next set of products
            });
            
            const loadMoreContainer = document.createElement("div");
            loadMoreContainer.className = "load-more-container";
            loadMoreContainer.appendChild(loadMoreBtn);
      
            // Append the button outside the products list container
            document.body.appendChild(loadMoreContainer);  // You may need to append it at the right position in your layout
          }
        }
      }
      
      // Share functionality with fallback for Android
      function shareLink(product_url) {
        if (navigator.share) {
          // If the browser supports the Web Share API (works on mobile)
          navigator.share({
            title: "Here's the product I found interesting",
            url: product_url
          }).then(() => {
            console.log("Product shared successfully!");
          }).catch((error) => {
            console.error("Error sharing the product: ", error);
            fallbackShare(product_url);
          });
        } else {
          fallbackShare(product_url);
        }
      }
      
      // Fallback share function (works for browsers that don't support Web Share API)
      function fallbackShare(product_url) {
        alert("This feature is not supported on your browser. You can copy the link manually: " + product_url);
      }
      
      // Helper function to shuffle an array
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }
      
      fetchProduct();


      // Show welcome title
      function showWelcomeTitle() {
        const welRef = ref(db, "admin/welcome_title");
        onValue(welRef, (snapshot) => {
          const welcomeTitle = snapshot.val();
          document.getElementById("welcome-title").innerText = welcomeTitle;
        });
      }
      showWelcomeTitle();

      // Function to get visitor IP and save to Firebase
      async function saveVisitorInfo() {
        try {
          // Get visitor's IP address
          const ipResponse = await fetch("https://api.ipify.org?format=json");
          const ipData = await ipResponse.json();
          const visitorIP = ipData.ip;

          // Replace dots in the IP address with underscores
          const safeVisitorIP = visitorIP.replace(/\./g, "_"); // Replace '.' with '_'

          // Get visitor's geolocation
          const geoResponse = await fetch(
            `https://ipapi.co/${visitorIP}/json/`
          );
          const geoData = await geoResponse.json();

          // Gather visitor details
          const visitorData = {
            ip: visitorIP,
            country: geoData.country_name || "Unknown",
            region: geoData.region || "Unknown",
            city: geoData.city || "Unknown",
            latitude: geoData.latitude || null,
            longitude: geoData.longitude || null,
            userAgent: navigator.userAgent,
            language: navigator.language || navigator.userLanguage,
            referrer: document.referrer || "Direct",
            screenResolution: `${window.screen.width}x${window.screen.height}`,
            timestamp: new Date().toISOString(),
          };

          // Save the visitor details to Firebase using the modified IP address
          const visitorRef = ref(db, "/visitors/" + safeVisitorIP);
          await set(visitorRef, visitorData);
        } catch (error) {
          console.error("Error saving visitor information:", error);
        }
      }

      // Search result open
      const search_form = document.getElementById("search_form");
      search_form.addEventListener("submit", (event) => {
        event.preventDefault();
        const search_input = document.getElementById("search").value;
        window.location.href = `/search_result?search=${search_input}`;
      });

      

      // Refer and earn
      const referBtn = document.getElementById("refer_earn");
      referBtn.addEventListener("click", () => {
        alert("You can't refer right now")
      });

      // Open user login page
      function openLoginPage() {
        auth.onAuthStateChanged((user) => {
          if (!user) {
            window.location.href = "login.html";
          }else{
            alert("User already logged in!")
          }
        });
      }

      //  Open dashboard page
      const my_dashboard = document.getElementById("my_dashboard");
      my_dashboard.addEventListener("click", () => {
        if(isUser){
          window.location.href = "/dashboard.html";
        }else{
          window.location.href = "https://roovix.com/login"
        }
      });
    </script>


    <!-- Aos animation on scroll -->
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
      AOS.init({
        offset: 100,
        duration: 500,
      });

      // scroll to top logic
      // Get the button element
      const scrollToTopBtn = document.getElementById("scroll-up-btn");

      // Show the button when the user scrolls down 100px from the top
      window.onscroll = function () {
        if (
          document.body.scrollTop > 100 ||
          document.documentElement.scrollTop > 300
        ) {
          scrollToTopBtn.style.display = "block";
        } else {
          scrollToTopBtn.style.display = "none";
        }
      };

      // Scroll the page back to the top when the button is clicked
      scrollToTopBtn.onclick = function () {
        window.scrollTo({ top: 0, behavior: "smooth" });
      };
    </script>

    <!-- Bootstrap js -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  </body>
</html>
