<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="language" content="en" />
    <meta name="author" content="Roovix" />
    <meta name="publisher" content="Roovix" />
    <meta
      name="description"
      content="Roovix Shop is your ultimate destination for quality products and deals. Explore our online store for the best shopping experience!"
    />
    <meta
      name="keywords"
      content="Roovix Shop, online shopping, quality products, best deals, e-commerce, Roovix"
    />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Roovix Shop - Quality Products & Best Deals"
    />
    <meta
      property="og:description"
      content="Explore Roovix Shop for quality products and great deals. Your trusted online store for the best shopping experience!"
    />
    <meta property="og:url" content="https://yourdomain.com" />
    <meta
      property="og:image"
      content="https://yourdomain.com/assets/roovix-shop-banner.jpg"
    />
    <meta property="og:site_name" content="Roovix Shop" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Roovix Shop - Quality Products & Best Deals"
    />
    <meta
      name="twitter:description"
      content="Check out Roovix Shop for quality products and unbeatable deals. Shop online with us today!"
    />

        <!-- FOnt awesome -->
        <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
      />

    <!-- Google Verification -->
    <meta
      name="google-site-verification"
      content="your-google-site-verification-code"
    />

    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://roovix.com/images/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://roovix.com/images/logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://roovix.com/images/logo.png">

    <!-- LInk too css -->
     <link rel="stylesheet" href="styles/dashboard.css">

    <!-- Link to js -->
     <script src="config.js"></script>
     <script src="https://cdn.tailwindcss.com"></script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Roovix - My Profile</title>
  </head>
  <body>

    <!-- Alert Body start -->
    <div id="alert" class="fixed hidden z-50 inset-0 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4 sm:px-0 text-center">
        
        <!-- Overlay Background -->
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
          <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
        </div>

        <!-- Modal Content -->
        <div class="bg-white rounded-lg shadow-xl overflow-hidden transform transition-all w-full max-w-md sm:w-3/4 sm:max-w-lg sm:my-8">
          <!-- Close Button -->
          <div class="absolute top-0 right-0 pt-4 pr-4">
            <button type="button" onclick="closeAlert()" class="text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <span class="sr-only">Close</span>
              <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          <!-- Icon and Message -->
          <div class="p-6">
            <div class="flex flex-col sm:flex-row items-center">
              <div class="flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                <svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
              </div>
              <div class="mt-4 sm:mt-0 sm:ml-4 text-center sm:text-left">
                <h3 id="alert_title" class="text-lg font-medium text-gray-900">
                  Your Confirmation Message
                </h3>
                <p id="alert_description" class="mt-2 text-sm text-gray-500">
                  Your body text goes here.
                </p>
              </div>
            </div>
            
            <!-- Buttons -->
            <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
              <button id="alert_confirm_btn" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto">
                Confirm
              </button>
              <button onclick="closeAlert()" id="alert_cancel_btn" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:w-auto">
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Alert Body end -->

    <!-- Uploading popup start -->
    <div class="modal" id="upload-modal">
      <div class="modal-content">
        <div class="loader"></div>
        <p class="modal-message">Uploading... Please wait.</p>
      </div>
    </div>
    <!-- Uploading popup end -->

    <!-- Success popup start -->
    <div id="success_popup" class="fixed hidden z-10 inset-0 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
          <div class="fixed inset-0 transition-opacity">
              <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
          </div>
          <span class="hidden sm:inline-block sm:align-middle sm:h-screen"></span>
          <div
              class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
              <div class="sm:flex sm:items-start">
                  <div
                      class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10">
                      <svg class="h-6 w-6 text-green-600" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                      </svg>
                  </div>
                  <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                      <h3 id="success_title" class="text-lg leading-6 font-medium text-gray-900">
                          
                      </h3>
                      <div class="mt-2">
                          <p id="success_message" class="text-sm leading-5 text-gray-500">
                              
                          </p>
                      </div>
                  </div>
              </div>
              <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                  <span class="flex w-full rounded-md shadow-sm sm:ml-3 sm:w-auto">
                      <button onclick="closeSuccessPopup()" type="button"
                          class="inline-flex justify-center w-full rounded-md border border-transparent px-4 py-2 bg-green-600 text-base leading-6 font-medium text-white shadow-sm hover:bg-green-500 focus:outline-none focus:shadow-outline-green transition ease-in-out duration-150 sm:text-sm sm:leading-5">
                          OK
                      </button>
                  </span>
              </div>
          </div>
      </div>
  </div>
    <!-- Success popup end -->

      <!-- Side left start-->
      <button id="side_left_toggle"><i class="fa-solid fa-bars"></i></button>
       <div id="side_left" class="side_left shadow-lg rounded-lg">
          <div class="side_left_title">
            <a href="https://roovix.com" class="flex gap-2 items-center">
              <img src="images/logo.png" alt="profile_picture">
              <p style="font-size: 1.2rem;">Roovix Shop</p>
            </a>
            <button id="side_left_close"><i class="fa-solid fa-circle-xmark"></i></button>
          </div>
        <ul class="side_left_ul">
          <li>
            <i class="fa-solid fa-user-circle"></i> My Account
          </li>
          <li id="earnings_item">
            <i class="fa-solid fa-hand-holding-dollar"></i> Earnings
          </li>
          <li><i class="fa-regular fa-credit-card"></i> Card</li>
          <li>
            <i class="fa-solid fa-chart-line"></i> Charts <i class="fa-solid list_arrow fa-chevron-down"></i>
            <ul class="sub_list">
              <li class="sub_list_item">Analytics</li>
              <li class="sub_list_item">Income history</li>
            </ul>
          </li>
        </ul>
       </div>
       <!-- Side left end -->

       <!-- Main start -->
        <div class="main">

          <!-- Profile start -->
          <section id="profile_section">
            <!-- Main Content -->
            <main class="h-auto mx-auto mt-6">
              <div class="bg-white shadow-md rounded-lg p-6">
                <!-- Profile Section -->
                <div class="flex flex-col sm:flex-row items-center gap-6">
                  <div class="flex-shrink-0">
                    <img id="user_profile_picture" class="w-24 h-24 bg-gray-300 rounded-full object-cover"></img>
                  </div>
                  <div class="text-center sm:text-left">
                    <div class="user_name_container flex items-center justify-center sm:justify-start gap-2">
                      <h2 id="user_name" class="text-2xl font-semibold"></h2>
                      <svg id="verified" class="hidden" style="fill: #085FEC; width: 1.3rem;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="m346.92-70.77-72.77-124.61-141.07-31.39 14.46-145.08L51.85-480l95.69-108.15-14.46-145.08 141.07-31.39 72.77-124.61L480-832.92l133.08-56.31 72.77 124.61 141.07 31.39-14.46 145.08L908.15-480l-95.69 108.15 14.46 145.08-141.07 31.39-72.77 124.61L480-127.08 346.92-70.77ZM438-345.69 658.31-566 611-611.77l-173 173-87-88.54L303.69-480 438-345.69Z"/></svg>
                    </div>
                    <p id="user_id_container" class="hidden items-center gap-1.5">Uid: <span id="user_uid">none</span> <i id="user_uid_copy" class="fa-regular fa-copy text-sm cursor-pointer"></i></p>
                    <button onclick="openEditProfileModal()" class="mt-2 px-4 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600">
                      Edit Profile
                    </button>
                  </div>
                </div>

                <!-- Description or bio Section -->
                <div class="mt-6 text-center">
                  <p id="profile_description" class="text-gray-600 md:text-lg"></p>
                </div>

                 <!-- Activity snapshot Section -->
                <div id="about_section" class="mt-6 flex items-center justify-around rounded-[5px] bg-gray-100 h-[120px]">
                  <div class="balance_bg flex-1 flex flex-col items-center">
                    <div class="balance_bg flex items-center gap-[2px] font-semibold">
                      <p id="currency" class="text-[0.9rem] mt-1 text-[#326196]">৳</p>
                      <p id="balance" class="text-2xl text-[#326196]">0</p>
                    </div>
                    <p>Balance</p>
                  </div>
                  <div class="divider h-10 w-[3px] bg-gray-200"></div>
                  <div class="link_click_bg flex-1 flex items-center flex-col">
                    <div class="link_click_bg">
                      <div class="view_link_bg">
                        <div class="count_bg font-semibold">
                          <p id="link_click" class="text-2xl text-center text-[#326196]">0</p>
                        </div>
                        <p>Link click</p>
                      </div>
                      <div class="link_click_shorts_analytics_bg">
                          <!-- Coming soon -->
                      </div>
                    </div>
                  </div>
                  <div class="divider h-10 w-[3px] bg-gray-200"></div>
                  <div class="order_bg flex-1 flex flex-col items-center">
                    <div class="order_count_bg">
                      <p id="order_count" class="text-2xl font-semibold text-center text-[#326196]">0</p>
                      <p>Orders</p>
                    </div>
                  </div>
                </div>

                <!-- Tabs -->
                <div class="mt-6 border-t border-gray-200">
                  <nav class="flex space-x-4 mt-4">
                    <a id="about_option" href="#" class="text-blue-500 border-b-2 border-blue-500 pb-2">About</a>
                    <!-- <a id="posts_option" href="#" class="text-gray-600 hover:text-blue-500">Posts</a>
                    <a id="comments_option" href="#" class="text-gray-600 hover:text-blue-500">Comments</a> -->
                  </nav>
                </div>

                <!-- Sidebar Menu -->
                <aside class="mt-6">
                  <div class="bg-gray-100 rounded-lg p-4">
                    <ul class="flex flex-col gap-2">
                      <li id="address_item" class="py-2 cursor-pointer rounded-md p-3.5 hover:bg-gray-200"><a href="#" class="text-gray-700 ">Address</a></li>
                      <li id="account_details_item" class="py-2 cursor-pointer rounded-md p-3.5 hover:bg-gray-200"><a href="#" class="text-gray-700 ">Account Details</a></li>
                      <li id="logout_item" class="py-2 cursor-pointer rounded-md p-3.5 hover:bg-gray-200"><a href="#" class="text-gray-700 ">Log Out</a></li>
                    </ul>
                  </div>
                </aside>
              </div>
            </main>
          </section>
          <!-- Profile end -->

          <!-- Edit profile start -->
          <div id="editProfileModal" class="fixed hidden inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50">
            <div class="bg-white rounded-lg shadow-2xl w-[90%] md:w-[60%] lg:w-[50%] p-6 relative">
              <button onclick="closeEditProfileModal()" class="absolute top-2 right-2 text-gray-700 hover:text-gray-900">
                &#10005; <!-- Close icon (X) -->
              </button>
              
              <h1 style="opacity: 0;" class="text-3xl font-serif font-bold mb-2 text-gray-800">Profile</h1>
              <h2 style="opacity: 0;" class="text-gray-600 text-sm mb-4">Create Profile</h2>
              
              <div id="edit_profile_form">
                <!-- Cover Image -->
                <div class="w-full rounded-sm bg-cover bg-center bg-no-repeat h-40" style="background-image: url('https://png.pngtree.com/thumb_back/fh260/background/20210115/pngtree-blue-gradient-web-ui-background-image_518658.jpg');">
                  <!-- Profile Image -->
                  <div id="profile_image_preview" class="mx-auto w-[141px] h-[141px] rounded-full bg-cover bg-center bg-no-repeat bg-gray-100 -mt-20">
                    <label for="upload_profile" class="absolute bg-white p-2 rounded-full cursor-pointer mt-28 ml-20">
                      <input type="file" id="upload_profile" class="hidden">
                      <!-- Upload Icon -->
                      <svg style="fill: rgba(0, 0, 0, 0.493);" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M480-260q75 0 127.5-52.5T660-440q0-75-52.5-127.5T480-620q-75 0-127.5 52.5T300-440q0 75 52.5 127.5T480-260Zm0-80q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29ZM160-120q-33 0-56.5-23.5T80-200v-480q0-33 23.5-56.5T160-760h126l74-80h240l74 80h126q33 0 56.5 23.5T880-680v480q0 33-23.5 56.5T800-120H160Z"/></svg>
                    </label>
                  </div>
                </div>
                
                <!-- Form Fields -->
                <div class="mt-10">
                  <label class="block mb-1 text-gray-700">Name</label>
                  <input id="name_edit" type="text" class="w-full p-3 border-2 rounded-lg" placeholder="Edit your name">
                  
                  <label class="block mb-1 mt-3 text-gray-700">Bio</label>
                  <input id="description_edit" type="text" class="w-full p-3 border-2 rounded-lg" placeholder="Your short description">
                </div>
                <div class="flex flex-col md:flex-row gap-4 mt-4">
                  <div class="w-full">
                    <label class="block mb-1 text-gray-700">Sex</label>
                    <select id="sex_edit" class="w-full p-3 border-2 rounded-lg">
                      <option disabled>Select Sex</option>
                      <option>Male</option>
                      <option>Female</option>
                    </select>
                  </div>
                  <div class="w-full">
                    <label class="block mb-1 text-gray-700">Date of Birth</label>
                    <input id="date_of_birth_edit" type="date" class="w-full p-3 border-2 rounded-lg">
                  </div>
                </div>
                
                <!-- Submit Button -->
                <div class="mt-6">
                  <button id="profile_edit_confirm_btn" type="button" class="w-full bg-blue-500 text-white p-3 rounded-lg">Confirm</button>
                </div>
              </div>
            </div>
          </div>
          <!-- Edit profile end -->

        </div>
        <!-- Main end -->

    <!-- Js logic for menu -->
     <script>
        document.addEventListener('DOMContentLoaded', function () {
            const items = document.querySelectorAll('.side_left_ul > li');

            // Select the first item and its first sub-item by default
            if (items.length > 0) {
                const firstItem = items[0];
                const firstSubList = firstItem.querySelector('.sub_list');
                const firstArrow = firstItem.querySelector('.list_arrow');

                // Make the first main item selected by default
                firstItem.classList.add('list_hover_design');
                if (firstSubList) {
                    firstSubList.classList.add('show');
                    firstArrow.style.transform = 'rotate(180deg)';

                    // Set the first sub-item of the first item as selected by default
                    const firstSubItem = firstSubList.querySelector('.sub_list_item');
                    if (firstSubItem) {
                        firstSubItem.classList.add('sub_item_selected');
                    }
                }
            }

            items.forEach((item) => {
                const arrow = item.querySelector('.list_arrow');
                const subList = item.querySelector('.sub_list');

                // Handle main item click
                item.addEventListener('click', function () {
                    // Hide other opened sub-lists, remove hover design, and clear selected sub-items
                    items.forEach((el) => {
                        if (el !== item) {
                            const otherSubList = el.querySelector('.sub_list');
                            const otherArrow = el.querySelector('.list_arrow');
                            const otherSubItems = el.querySelectorAll('.sub_list_item');

                            // Hide sub-list and reset styles
                            otherSubList?.classList.remove('show');
                            // otherArrow.style.transform = 'rotate(0deg)';
                            el.classList.remove('list_hover_design');

                            // Remove selected style from all sub-items of other lists
                            otherSubItems.forEach((si) => si.classList.remove('sub_item_selected'));
                        }
                    });

                    // Toggle the current sub-list
                    const isVisible = subList && subList.classList.contains('show');
                    if (isVisible) {
                        subList.classList.remove('show');
                        // arrow.style.transform = 'rotate(0deg)';
                        item.classList.remove('list_hover_design');
                    } else {
                        subList?.classList.add('show');
                        // arrow.style.transform = 'rotate(180deg)';
                        item.classList.add('list_hover_design');
                    }
                });

                // Handle sub-item click
                if (subList) {
                    const subItems = subList.querySelectorAll('.sub_list_item');

                    subItems.forEach((subItem) => {
                        subItem.addEventListener('click', function (event) {
                            // Prevent parent item from collapsing
                            event.stopPropagation();

                            // Remove selected style from all sub-items of the same parent
                            subItems.forEach((si) => si.classList.remove('sub_item_selected'));

                            // Apply selected style to clicked sub-item
                            subItem.classList.add('sub_item_selected');
                        });
                    });
                }
            });
        });

      // Side hide show functionality
      const sideLeftToggle = document.getElementById('side_left_toggle');
      const sideLeft = document.getElementById('side_left');

      // Close buttons for both side panels
      const sideLeftClose = document.getElementById('side_left_close');

      // Function to show the left panel
      function showLeftPanel() {
          sideLeftClose.style.display = 'block';
          sideLeft.style.position = 'fixed';
          sideLeft.style.top = '0px';
          sideLeft.style.left = '0px';
          sideLeft.style.display = 'block'; // Show the left side panel
      }

      // Function to show the right panel
      function showRightPanel() {

          // Hide the left panel if it's visible
          if (sideLeft.style.display === 'block') {
              sideLeft.style.display = 'none';
          }
      }

      // Event listeners for showing panels
      sideLeftToggle.addEventListener('click', showLeftPanel);
      // Close left panel
      sideLeftClose.addEventListener('click', function () {
          sideLeft.style.display = 'none'; // Hide the left side panel
      });
    </script>

    <!-- Module script for firebase client side -->
     <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
        import {
          getDatabase,
          ref,
          onValue,
          get,
          set,
          update
        } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js";
        import {
          getAuth,
          onAuthStateChanged,
        } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-auth.js";
        import {
          getStorage,
          ref as storageRef,
          uploadBytesResumable,
          getDownloadURL
        } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-storage.js";

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const storage = getStorage(app);

        // Fetch users details start
        auth.onAuthStateChanged(async (user)=>{
          if(user){
            const user_id = user.uid;
            const usersRef = ref(db, 'users/' + user_id);
            onValue(usersRef, (snapshot) => {
              const userData = snapshot.val();
              if(snapshot){
                // Users profile element find by id
                const user_profile_picture = document.getElementById("user_profile_picture");
                const user_name = document.getElementById("user_name");
                const user_uid = document.getElementById("user_uid");
                const profile_description = document.getElementById("profile_description");

                // User activity element find by
                const balance = document.getElementById("balance");
                const currency = document.getElementById("currency");
                const link_click = document.getElementById("link_click");
                const order_count = document.getElementById("order_count");

                // Format user activity snapshot
                let balance_formatted = numberFormatter(userData.balance);
                let link_click_formatted = numberFormatter(userData.total_link_click);
                let order_count_formatted = numberFormatter(userData.order_count);

                // Show user activity details to profile
                balance.innerText = balance_formatted?? 0;
                currency.innerText = userData.currency?? "৳";
                link_click.innerText = link_click_formatted?? 0;
                order_count.innerText = order_count_formatted?? 0;

                // visible the user uid view after fetch successfully
                document.getElementById("user_id_container").classList.add('flex'); 
                document.getElementById("user_id_container").classList.remove('hidden'); 

                // Show user details in profile
                user_profile_picture.src = userData.profile_picture?? "https://roovix.com/images/difault_user_logo.png";
                user_name.innerText = userData.name?? "Anonymous";
                user_uid.innerText = userData.uid?? "none";
                profile_description.innerText = userData.description?? "You have no bio yet..!!";
                
                // Show profile details in edit profile
                document.getElementById("profile_image_preview").style.backgroundImage = `url(${userData.profile_picture})`;
                document.getElementById("name_edit").value = userData.name?? "";
                document.getElementById("description_edit").value = userData.description?? "";

              }
            });

            // Check user custom claims
            try {
              const idTokenResult = await user.getIdTokenResult();
              if (idTokenResult.claims.admin || idTokenResult.claims.seller) {
                // Visible the verified badge
                document.getElementById("verified").classList.remove('hidden');
              } else {
                // Hidden the verified badge
                document.getElementById("verified").classList.add('hidden');
              }
            }catch (e) {
              let alertTitle = document.getElementById("alert_title");
              let alertBody = document.getElementById("alert");
              let alertDescription = document.getElementById("alert_description");
              alertTitle.innerText = "Error!";
              alertDescription.innerText = "Failed to verify user claims! Do you want to apply for seller?";

              let alertConfirmBtn = document.getElementById("alert_confirm_btn");

              alertConfirmBtn.addEventListener("click", ()=>{
                // Hide the alert
                alertBody.classList.add('hidden');
                // Confirm logic coming soon..
              });

              // Show the alert
              alertBody.classList.remove('hidden');
            }
          }else{
            window.location.href = "/login.html"
          }
        });
        // Copy user uid to clipboard
        const user_uid_copy = document.getElementById("user_uid_copy");
        user_uid_copy.addEventListener("click", ()=>{
          const user_uid = document.getElementById("user_uid").innerText;
          navigator.clipboard.writeText(user_uid);
          alert("User UID copied to clipboard.");
        });
        // Fetch users details end

        // Edit user profile start
        const upload_profile = document.getElementById("upload_profile");
        let profile_picture = "";
        const uploading_popup = document.getElementById("upload-modal");
        upload_profile.addEventListener("change", (event) => {
          const profileImageContainer = document.getElementById('profile_image_preview');
          const file = event.target.files[0];
          
          if (file) {
            profile_picture = file;
            const reader = new FileReader();
            reader.onload = function(e) {
              profileImageContainer.style.backgroundImage = `url(${e.target.result})`;
            };
            reader.readAsDataURL(file);
          }
        });

        // Handle edit confirmation
        const profile_edit_confirm_btn = document.getElementById("profile_edit_confirm_btn");
        profile_edit_confirm_btn.addEventListener("click", ()=>{

            // Show the uploading popup
            uploading_popup.style.display = "flex";

              // Check if the user is logged in
              onAuthStateChanged(auth, (user) => {
                if (user) {
                  const userId = user.uid;  // Current user's ID
                  if(profile_picture){
                    // Create a storage reference
                    const storageReference = storageRef(storage, `users_profile_picture/${userId}`);
                    
                    // Upload the file
                    const uploadTask = uploadBytesResumable(storageReference, profile_picture);

                    // Monitor the upload process
                    uploadTask.on(
                      "state_changed",
                      (snapshot) => {
                        // Optional: Track progress
                        console.log('Uploading...', (snapshot.bytesTransferred / snapshot.totalBytes) * 100 + '%');
                      },
                      (error) => {
                        // Hide the uploading popup
                        uploading_popup.style.display = "none";
                        
                        let alertTitle = document.getElementById("alert_title");
                        let alertBody = document.getElementById("alert");
                        let alertDescription = document.getElementById("alert_description");
                        alertTitle.innerText = "Error during upload!";
                        alertDescription.innerText = `${error.message}`;

                        let alertConfirmBtn = document.getElementById("alert_confirm_btn");
                        let alertCancelBtn = document.getElementById("alert_cancel_btn");

                        // Hide error cancel btn
                        alertCancelBtn.classList.add('hidden');

                        alertConfirmBtn.addEventListener("click", ()=>{
                          // Hide the alert
                          alertBody.classList.add('hidden');
                          // Confirm logic coming soon..
                        });

                        // Show the alert
                        alertBody.classList.remove('hidden');
                      },
                      () => {
                        // Get download URL on success
                        getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                          // Update the download URL in the Realtime Database

                          // Save also user input data
                          let editUserBio = document.getElementById("description_edit").value;
                          let editUserName = document.getElementById("name_edit").value;

                          const userRef = ref(db, 'users/' + userId);
                          update(userRef, {
                            profile_picture: downloadURL,
                            name: editUserName,
                            description: editUserBio
                          })
                          .then(() => {
                            // Hide the uploading popup
                            uploading_popup.style.display = "none";

                            profile_picture = "";
                            
                            let success_profile_update_popup = document.getElementById("success_popup");
                            document.getElementById("success_title").textContent = "Successful";
                            document.getElementById("success_message").textContent = "You have successfully updated your profile!";
                            success_profile_update_popup.classList.remove('hidden');
                          })
                          .catch((error) => {

                            // Hide the uploading popup
                            uploading_popup.style.display = "none";

                            let alertTitle = document.getElementById("alert_title");
                            let alertBody = document.getElementById("alert");
                            let alertDescription = document.getElementById("alert_description");
                            alertTitle.innerText = "Error to update profile!";
                            alertDescription.innerText = `${error.message}`;

                            let alertConfirmBtn = document.getElementById("alert_confirm_btn");
                            let alertCancelBtn = document.getElementById("alert_cancel_btn");

                            // Hide error cancel btn
                            alertCancelBtn.classList.add('hidden');

                            alertConfirmBtn.addEventListener("click", ()=>{
                              // Hide the alert
                              alertBody.classList.add('hidden');
                              // Confirm logic coming soon..
                            });

                            // Show the alert
                            alertBody.classList.remove('hidden');
                          });
                        });
                      }
                    );
                  }else{
                    // Handle without profile picture edit profile
                    // Save also user input data
                    let editUserBio = document.getElementById("description_edit").value;
                    let editUserName = document.getElementById("name_edit").value;
                    const userRefForEditWithoutProfile = ref(db, 'users/' + userId);
                    update(userRefForEditWithoutProfile, {
                        name: editUserName,
                        description: editUserBio
                    }).then(()=>{
                      // Hide the uploading popup
                      uploading_popup.style.display = "none";

                      let success_profile_update_popup = document.getElementById("success_popup");
                      document.getElementById("success_title").textContent = "Successful";
                      document.getElementById("success_message").textContent = "You have successfully updated your profile!";
                      success_profile_update_popup.classList.remove('hidden');
                    }).catch((error) => {
                      // Hide the uploading popup
                      uploading_popup.style.display = "none";

                      let alertTitle = document.getElementById("alert_title");
                      let alertBody = document.getElementById("alert");
                      let alertDescription = document.getElementById("alert_description");
                      alertTitle.innerText = "Error to update profile!";
                      alertDescription.innerText = `${error.message}`;

                      let alertConfirmBtn = document.getElementById("alert_confirm_btn");
                      let alertCancelBtn = document.getElementById("alert_cancel_btn");

                      // Hide error cancel btn
                      alertCancelBtn.classList.add('hidden');

                      alertConfirmBtn.addEventListener("click", ()=>{
                        // Hide the alert
                        alertBody.classList.add('hidden');
                        // Confirm logic coming soon..
                      });

                      // Show the alert
                      alertBody.classList.remove('hidden');
                    });
                  }
                } else {
                  // Hide the uploading popup
                  uploading_popup.style.display = "none";

                  let alertTitle = document.getElementById("alert_title");
                  let alertBody = document.getElementById("alert");
                  let alertDescription = document.getElementById("alert_description");
                  alertTitle.innerText = "User error!";
                  alertDescription.innerText = `${error.message}`;

                  let alertConfirmBtn = document.getElementById("alert_confirm_btn");
                  alertConfirmBtn.textContent = "Login"

                  alertConfirmBtn.addEventListener("click", ()=>{
                    // Hide the alert
                    alertBody.classList.add('hidden');
                    window.location.href = "https://www.roovix.com/login"
                  });

                  // Show the alert
                  alertBody.classList.remove('hidden');
                }
              });
        })
        // Edit user profile end

        // Log out current user
        const logout_btn = document.getElementById("logout_item");
        logout_btn.addEventListener("click", ()=>{
          auth.signOut().then(() => {
            window.location.href = "/login.html";
          }).catch((error) => {
            console.error("Error signing out:", error);
          });
        });
     </script>
     
     <!-- functions start -->
     <script>
        function closeAlert() {
            const alertBody = document.getElementById("alert");
            alertBody.classList.add("hidden");
        }
        function closeEditProfileModal() {
          document.getElementById('editProfileModal').classList.add('hidden');
        }
        function openEditProfileModal() {
          document.getElementById('editProfileModal').classList.remove('hidden');
        }
        function closeSuccessPopup() {
            const success_popup = document.getElementById("success_popup");
            success_popup.classList.add("hidden");
        }

       
        // Number formatter like 1k, 1m, 1b
        function numberFormatter(number) {
          if (number >= 1_000_000_000) {
            return (number / 1_000_000_000).toFixed(1).replace(/\.0$/, '') + 'B';
          } else if (number >= 1_000_000) {
            return (number / 1_000_000).toFixed(1).replace(/\.0$/, '') + 'M';
          } else if (number >= 1_000) {
            return (number / 1_000).toFixed(1).replace(/\.0$/, '') + 'K';
          } else {
            return number;
          }
        }
     </script>
     <!-- functions end -->
  </body>
</html>
